INSERT INTO PERSON (
    MGLNR, 
    FNR, 
    FIRMA, 
    ANREDE, 
    TITEL, 
    NACHNAME,
    VORNAME,
    STRASSE,
    PLZ,
    ORT,
    LAND,
    HAUPTKATEGORIE,
    TELEFON_1,
    TELEFON_2,
    MOBIL,
    TELEFAX,
    EMAIL,
    GEBURTSDATUM,
    BEMERKUNG,
    STATUS, 
    EINTRITT,
    AUSTRITT,
    KUENDIGUNG,
    ABWEICHENDERZAHLER,
    ZAHLUNGSMODUS) 
    SELECT DISTINCT 
        MITGLIEDSNUMMER_SEWOBE, 
        FAMILIENNUMMER_SEWOBE,
        FIRMA, 
        ANREDE, 
        TITEL, 
        NACHNAME,
        VORNAME,
        STRASSE,
        PLZ,
        ORT,
        LAND ,
        HAUPTKATEGORIE,
        TELEFON_1,
        TELEFON_2,
        MOBIL,
        TELEFAX,
        EMAIL,
        GEBURTSDATUM,
        BEMERKUNG ,
        STATUS,
        EINTRITT,
        AUSTRITT,
        KUENDIGUNG, 
        ABWEICHENDERZAHLER,
        ZAHLUNGSMODUS 
    FROM DLRG.PERSON_STAGE;

INSERT INTO ADDRESS (
    MGLNR, 
    STRASSE,
    PLZ,
    ORT,
    LAND) 
    SELECT DISTINCT 
        MITGLIEDSNUMMER_SEWOBE,
        STRASSE,
        PLZ,
        ORT,
        LAND
    FROM DLRG.PERSON_STAGE;

INSERT INTO CONTACT (
    MGLNR, 
    CONTACTKEY,
    CONTACTVALUE) 
    SELECT DISTINCT 
        MITGLIEDSNUMMER_SEWOBE,
        'Telefon-1',
        TELEFON_1
    FROM DLRG.PERSON_STAGE where TELEFON_1 IS NOT NULL;

INSERT INTO CONTACT (
    MGLNR, 
    CONTACTKEY,
    CONTACTVALUE) 
    SELECT DISTINCT 
        MITGLIEDSNUMMER_SEWOBE,
        'Telefon-2',
        TELEFON_2
    FROM DLRG.PERSON_STAGE where TELEFON_2 IS NOT NULL;

INSERT INTO CONTACT (
    MGLNR, 
    CONTACTKEY,
    CONTACTVALUE) 
    SELECT DISTINCT 
        MITGLIEDSNUMMER_SEWOBE,
        'Mobil',
        MOBIL
    FROM DLRG.PERSON_STAGE where MOBIL IS NOT NULL;

INSERT INTO CONTACT (
    MGLNR, 
    CONTACTKEY,
    CONTACTVALUE) 
    SELECT DISTINCT 
        MITGLIEDSNUMMER_SEWOBE,
        'Telefax',
        TELEFAX
    FROM DLRG.PERSON_STAGE where TELEFAX IS NOT NULL;

INSERT INTO CONTACT (
    MGLNR, 
    CONTACTKEY,
    CONTACTVALUE) 
    SELECT DISTINCT 
        MITGLIEDSNUMMER_SEWOBE,
        'e-Mail',
        EMAIL
    FROM DLRG.PERSON_STAGE where EMAIL IS NOT NULL;

INSERT INTO BANKVERBINDUNG (
    MGLNR,
    FNR,
    IBAN,
    BIC,
    KONTOINHABER,
    MANDATSREFERENZ,
    MANDAT_VORHANDEN)
    SELECT DISTINCT 
        MITGLIEDSNUMMER_SEWOBE, 
        FAMILIENNUMMER_SEWOBE,
        IBAN,
        BIC,
        KONTOINHABER,
        MANDATSREFERENZ,
        MANDAT_VORHANDEN 
    FROM PERSON_STAGE 
    WHERE IBAN IS NOT NULL;

INSERT INTO BEITRAG (
    MGLNR,
    FNR,
    BEITRAGSPOSITION,
    ABRECHNUNGSSTATUS,
    ZAHLUNGSWEISE)
    SELECT MGLNR, 
        FNR,
        BEITRAGSPOSITION,
        ABRECHNUNGSSTATUS,
        ZAHLUNGSWEISE 
        FROM (SELECT 
                MITGLIEDSNUMMER_SEWOBE AS MGLNR, 
                FAMILIENNUMMER_SEWOBE AS FNR,
                BEITRAGSPOSITION,
                ABRECHNUNGSSTATUS,
                ZAHLUNGSWEISE,  
                COUNT(*)
            FROM PERSON_STAGE 
            WHERE BEITRAGSPOSITION IS NOT NULL
            GROUP BY MITGLIEDSNUMMER_SEWOBE,
                FAMILIENNUMMER_SEWOBE,
                BEITRAGSPOSITION,
                ABRECHNUNGSSTATUS,
                ZAHLUNGSWEISE
            HAVING COUNT(*) >0) AS XX;


INSERT INTO RECHNUNG (
    RECHNUNGSNUMMER,
    MGLNR,
    FNR,
    RECHNUNGSDATUM,
    RECHNUNGSSUMME)
    SELECT DISTINCT RECHNUNGSNUMMER,
        MITGLIEDSNUMMER_SEWOBE, 
        FAMILIENNUMMER_SEWOBE,
        RECHNUNGSDATUM,
        RECHNUNGSSUMME 
    FROM PERSON_STAGE 
    WHERE RECHNUNGSNUMMER IS NOT NULL;